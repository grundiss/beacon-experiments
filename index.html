<!DOCTYPE html>
<html>
    <head><title>Beacon experiments</title></head>
    <body>
        <h1>Rev-4</h1>

        <script type="text/javascript">
            window.addEventListener('load', function() {
                fetch('/hello', {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({fizz: 'buzz'})
                }).then(function (response) {
                    return response.text();
                }).then(function (text) {
                    console.log(text);
                });
            });

            window.addEventListener('beforeunload', function(event) {
                const data = JSON.stringify({foo: 'bar'});

                window.navigator.sendBeacon('/beacon-4', data);
            });
        </script>
    </body>
</html>